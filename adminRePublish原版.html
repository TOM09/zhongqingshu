<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>重新发布职位</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
		<meta name="toTop" content="true">
		<link href="/static/css/base.css" rel="stylesheet" type="text/css" />
		<!--bootstrap框架↓-->
		<link href="/static/bootstrap-3.3.7-dist/css/bootstrap.css" rel="stylesheet" type="text/css" />
		<link href="/static/bootstrap-3.3.7-dist/css/bootstrap-theme.css" rel="stylesheet" type="text/css" />
		<!--本页面CSS↓-->
		<link rel="stylesheet" href="/static/css/swiper.css">
		<link rel="stylesheet" href="/static/css/style.css">
		<link rel="stylesheet" href="css/util.css">
		<!--bootstrap框架↓-->
		<script type="text/javascript" src="/static/js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
		<script type="text/javascript" src="/static/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
		<script type="text/javascript" src="/static/js/jquery.tabslet.min.js"></script>
		<script type="text/javascript" src="/static/js/util.js"></script>
		<script type="text/javascript" src="/static/js/index.js"></script>
		<link href="/static/bootstrap-3.3.7-dist/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
		<script src="/static/bootstrap-3.3.7-dist/js/moment-with-locales.min.js"></script>
		<script src="/static/bootstrap-3.3.7-dist/js/bootstrap-datetimepicker.min.js"></script>
		<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.4&key=8e2c24150d9743810be9ae4fa2461da5"></script>
	</head>

	<body style="background-color: white;">
		<div class="w1200">
			<div class="main_fff mar_box" style="margin: 0;">
				<input type="hidden" id='id' name='id'></input>
				<dl class="Login_tit">
					<dt>发布职位</dt>
				</dl>
				<div class="person_box">
					<div class="person_list">
						<div class="person_list_name">
							职位分类：
						</div>
						<p id="view"></p>
					</div>
					<div id="interViewTime" style='display:none'>
						<div class="form-group">
							<div class="person_list_name">
								视频面试时间：
							</div>
							<!--指定 date标记-->
							<div style="float:left" class='input-group date col-sm-3' id='datetimepicker1'>
								<input type='text' id="startTime" name="startTime" class="form-control" style="height:40px;" />
								<span class="input-group-addon">  
	                    <span class="glyphicon glyphicon-calendar"></span>
								</span>
							</div>
							<div style="float:left">至</div>
							<div style="float:left" class='input-group date col-sm-3' ' id='datetimepicker2 ' >  
	                <input type='text ' id="endTime" name="endTime" class="form-control" style="height:40px;"/>  
	                <span class="input-group-addon">  
	                    <span class="glyphicon glyphicon-calendar"></span>
	                </span>
  	            </div><lable id="lable_trainTime" style="color:red;"></lable>
   	        </div>  
   		</div> 
   		 
		<div class="person_list">
        	<div class="person_list_name">
            	职位类型：
            </div>
            <div class="person_list_box" >
            	<select class="person_list_selects" id="positionTypeId1" onchange='queryWorkPositionTypeId2() '>
						<option value='-1 '>====请选择职位类型====</option>
            	</select>
                <select class="person_list_selects" id="positionTypeId2">
                  
                </select>
            </div>
        </div>
		
		<div class="person_list">
        	<div class="person_list_name">
            	职位名称：
            </div>
            <div class="person_list_box positionName">
            </div>
        </div>
		
		<div class="person_list">
        	<div class="person_list_name">
            	月薪范围：
            </div>
            <div class="person_list_box">
            	<select class="person_list_selects" id="salaryScope" >
            	 	 <option value='-1 '>==请选择月薪==</option>
            	</select>
            </div>
        </div>
        
        <div class="person_list">
        	<div class="person_list_name">
            	工作地点：
            </div>
            <div class="person_list_box">
            	<select class="person_list_select" id="province" onchange='queryCity() '>
            		<option value='-1 '>==请选择工作地==</option>
            	</select>
                <select class="person_list_select" id="city" style="margin-left: 15px;" onchange='queryDistrict() '></select>
	            <select class="person_list_select" id="district" style="margin-left: 15px;"></select>
            </div>
        </div>
   
         <div class="person_list">
                <div class="person_list_name">
                   	 详细地址：
                </div>
                <div class="person_list_box">
                    <input class="person_list_inputs" readonly id="addressDetail" name="addressDetail"/><span><img onclick="showMap()" src="/static/images/icon_location.png"/></span>
                    <input id="lon" name="lon" type="hidden" value=""/>
                    <input id="lat" name="lat" type="hidden" value=""/>
                </div>
         </div>
        
        <div class="person_list">
        	<div class="person_list_name">
            	工作性质：
            </div>
            <div class="person_list_box">
            	<select class="person_list_selects" id="natureWork">
            	  
            	</select>
            </div>
        </div>
        
        <div class="person_list">
        	<div class="person_list_name">
            	经验要求：
            </div>
            <div class="person_list_box">
            	<select class="person_list_selects" id="workExperience">
				
				</select>
            </div>
        </div>
		
		<div class="person_list">
        	<div class="person_list_name">
            	学历要求：
            </div>
            <div class="person_list_box">
            	<select class="person_list_selects" id="education" value=${position.degreeLevel}>
            	  
            	</select>
            </div>
        </div>
        
        <div class="person_list" style="line-height:36px;">
        	<div class="person_list_name">
            	职位标签：
            </div>
            <div id='plabel' class="person_list_box" style="line-height:36px;width: 584px;">
		
            </div>
        </div>
        
        <div class="person_list" style="line-height:36px;">
        	<div class="person_list_name">
            	岗位职责：
            </div>
            <div class="person_list_box" style="line-height:36px;">

				<textarea  style="overflow-y:scroll;" class="person_list_texteara" id="responsibility"  onkeyup="limitTextarea(this)">${position.responsibility}</textarea><span class="textare_ts"><b class="nowTextLength">0</b>/500</span>
	
            </div>
        </div>
		
		<div class="person_list" style="line-height:36px;">
        	<div class="person_list_name" >
            	职位描述：
            </div>
            <div class="person_list_box" style="line-height:36px;">
				<textarea  style="overflow-y:auto;" class="person_list_texteara" id="description" onkeyup="limitTextarea(this)">${position.description}</textarea><span class="textare_ts"><b class="nowTextLength">0</b>/500</span>

            </div>
        </div>
        <button class="person_list_btn" onclick="submit()">发布职位</button>    
        
    </div>
	
	
</div>
</div>	
<!--尾部开始-->

<div class="modal fade" id="map" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="margin-top: 5px;width: 98%;">
        <div id="container" tabindex="0" style="position: relative;height: 600px;margin-top:  50px;"></div>
        <div style="position:absolute;top:20px;left:30px;">
            <input id="mapAddress" type="text" style="width:500px;;height:50px;border:1px solid #ccc;" value="" />
            <button type="button"  style="text-align: center;margin: 20px 0;width: 100px;height: 46px;line-height:32px;background: rgba(232,13,34,1);border-radius: 4px;color: #fff;font-size: 18px;border: 0px;"  onclick="searchMap()" id="searchAddress">搜索
            </button>
            <button type="button" style="text-align: center;margin: 20px 0;width: 100px;height: 46px;line-height:32px;background: rgba(232,13,34,1);border-radius: 4px;color: #fff;font-size: 18px;border: 0px"  id="postAddress">确定</button>
        </div>
        <a href="javascript:void(0);" id="closeMap" style="position:absolute;right: -10px;top: -15px;font-size: 30px;background: #f5efef;border-radius: 30px;width: 35px;height: 30px;text-align:  center;">X</a>
    </div>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="margin-top: 300px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                </div>
                <div class="modal-body" id="prompt">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">确定
                    </button>
                </div>
            </div>
        </div>
    </div>
<!--尾部end-->
<script type="text/javascript" src="js/header.js"></script>
<script type="text/javascript" src="js/footer.js"></script>
<script type="text/javascript">
	var companyId =+ localStorage.getItem('companyId ');
	var arr= [];
	var address;
	var markers=[];
	var lngData;
	var latData;
	var type="province";
	
	function GetRequest() { 
	   var url = location.search; //获取url中"?"符后的字串 
	   if (url.indexOf("?") != -1) { 
	      var str = url.substr(1); 
	      strs = str.split("=")[1]; 
	   } 
	   return strs; 
	}
	let positionId = GetRequest();
	
    function searchMap() {
        var serchaddress = $("#mapAddress").val();
        if(serchaddress != ""){
            placeSearch.search(serchaddress, searchAddressfunc);
        }
    }
    function limitTextarea(obj){
        var num = $(obj).val().length;
       $(obj).siblings('span').find('.nowTextLength').css('color','#9B9B9B').text(num);
        if(num>500)
        {
            $(obj).siblings('span').find('.nowTextLength').css('color','#E80D22');
        }
    };
    
	$(function () {
        limitTextarea($("#responsibility")[0]);
        limitTextarea($("#description")[0]);
        $('#closeMap ').click(function(){
            $('#map ').modal('hide ');
        })
        $("#postAddress").click(function () {
            $("#addressDetail").val(address);
            $("#lon").val(lngData);
            $("#lat").val(latData);
            $('#map ').modal('hide ');
        })
        $(".linkChild").eq(4).addClass("accordionActive");
        $(".submenu").eq(2).css({
            "display": "block"
        });
        if(1 == 1){ //isSubAccount
            $(".linkChild").eq(0).addClass("accordionActive");
            $(".submenu").eq(0).css({
                "display": "block"
            });
        }
	 	if ($("#view").text()=="视频"){ 
			$("#interViewTime").css('display ','block ')
		}
		var parentId = 0
		//首次传参应该传播 workPositionTypeId
		quWoPoTyId(parentId)
	//	queryWorkPositionTypeId1(parentId)
		querySalaryScope()
		queryNatureWork()
		queryWorkExperience()
		queryEeducation()
		queryAddress(type,parentId)	
		queryLabel()
	    $('#datetimepicker1 ').datetimepicker({  
	        format: 'YYYY-MM-DD HH:mm ',  
	        locale: moment.locale('zh-cn ')  
	    });   
	    $('#datetimepicker2 ').datetimepicker({  
	        format: 'YYYY-MM-DD HH:mm ',  
	        locale: moment.locale('zh-cn ')  
	    });  
	    map = new AMap.Map('container ',{
	    	resizeEnable:true,
            zoom:15,
            center:[116.480983, 40.0958]
        });
        map.on('click ', function(e) {
            lngData = e.lnglat.getLng();
            latData = e.lnglat.getLat();
            var lnglatXY = [e.lnglat.getLng(),e.lnglat.getLat()];
            $("#lon").val(e.lnglat.getLng())
            $("#lat").val(e.lnglat.getLat())
            geocoder.getAddress(lnglatXY, function(status, result) {
                if (status === 'complete ' && result.info === 'OK ') {
                    address = result.regeocode.formattedAddress;
                    $("#mapAddress").val(address);
                    map.remove(markers);
                    marker = new AMap.Marker({
                        position: lnglatXY,
                        title: address,
                        map: map
                    });
                    markers.push(marker);
                }else{
                }
            });

        });
        AMap.service('AMap.Geocoder ',function(){
            geocoder = new AMap.Geocoder({
                city: "010"//城市，默认：“全国”
            });
            
        })
        map.plugin('AMap.Geolocation ', function() {
            geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,
                timeout: 10000,
                buttonOffset: new AMap.Pixel(10, 20),
                zoomToAccuracy: true,
                buttonPosition:'RB '
            });
            map.addControl(geolocation);
            AMap.event.addListener(geolocation, 'complete ', onComplete);//返回定位信息
        });
        AMap.service(["AMap.PlaceSearch"], function() {
            placeSearch = new AMap.PlaceSearch({ //构造地点查询类
                pageSize: 1,
                pageIndex: 1,
                city: "010"//城市
            });
        });
		initialization()
	}); 
	
	function initialization(){
			// 是普通还是视频
				var queryData = {};
				queryData.clientType = 102500;
				queryData.positionId = positionId;
			//上线职位
				ajax("/services/position/view", queryData, function(msg){
					console.log(dataObj)
						var dataObj = msg.datas[0];
				//普通or视频
						if(dataObj.isVideoInterview){
								$('#view ').text("视频")
							}else{
								$('#view ').text("普通")
							}
				//职位名称
						$('.positionName ').text(dataObj.name);
				//岗位职责
				$('#responsibility ').val(dataObj.responsibility)
				//职位描述
				$('#description ').val(dataObj.description)
				//详细地址
				$('#addressDetail ').val(dataObj.detailedAddress)
				//省份
				var workCity = dataObj.workCity.split('_ ');
				
		
		
							var obj = {};
							obj.positionId = dataObj.id;
							obj.companyId = dataObj.companyId;
							obj.workPositionTypeId = dataObj.workPositionTypeId;
							obj.salaryScopeId = dataObj.salaryScopeName;
							obj.detailedAddress = dataObj.detailedAddress;   
							obj.lon = dataObj.lon;
							obj.lat = dataObj.lat;
							obj.workExperienceId = dataObj.workExperienceId;
							obj.degreeLevel = dataObj.degreeLevel;

							obj.responsibility = dataObj.responsibility;
							obj.isVideoInterview = dataObj.isVideoInterview;
							obj.videoInterviewStartDate =dataObj.videoInterviewStartDate;
							obj.videoInterviewEndDate = dataObj.videoInterviewEndDate;
								console.log(dataObj)
					})
		
		console.log($("#province").html())
		if(("#province").val != ' '){
			<!--queryCity();-->
		}
		if ('${workPositionType.parentId} ' == null ||'${workPositionType.parentId} ' == ' '){
			$("#positionTypeId1").val('${workPositionType.id} ')
		}else{
			$("#positionTypeId1").val('${workPositionType.parentId} ')
			
		}
		if(("#positionTypeId1").val != ' '){
			queryWorkPositionTypeId2();
		}
		$("#startTime").val('${startTime} ');
		$("#endTime").val('${endTime} ');
        $("#lon").val('${position.lon} ');
        $("#lat").val('${position.lat} ');
        lngData = '${position.lon} ';
        latData = '${position.lat} ';
		$("#description").val('${position.description} ')
		$("#responsibility").val('${position.responsibility} ')
	}
			
	/* 获得职位标签 */
	function queryLabel() {
		var parentIdData = {};
		//      parentIdData.parentId=parentId;
		parentIdData.clientType = 102500;
		parentIdData.type = "position_label";
		ajax("/services/dict/type/list", parentIdData, function(msg) {
			var msgDatas = msg.datas;
			//type = position_label
			var ops = "";
			$.each(msgDatas, function(i, positionLabel) {
				var labelId = i + 1
				ops += "<span class='person_biaoq '><a href='javascript:void(0); ' style='cursor:pointer;display: inline-block; ' id=' " + positionLabel.id + " ' >" + positionLabel.name + "</a></span>";
			});
			//    			  		循环生成的标签放入#plabel中
			ops += "<span class='person_biaoqNO '>标签最多选择5个</span>";
			$("#plabel").html(ops);
			
			var spans = $("#plabel").find("span")
			//循环span
			$("#plabel>span").each(function(){
				//第一个span点击的时候
				var obj = this.children[0]
				$(obj).click(function() {
					//如果这个span.id在数组内，颜色变化，循环
					if(IsInArray(arr, this.text)) {
						console.log(1)
						$(this).css('color', '#8A8A8A');
						var n;
						//循环数组的长度，如果数组的第i个等于span的id，就让n=i  最后即等于标签数量
						for(var i = 0; i < arr.length; i++) {
							if(arr[i] == this.text) {
								n = i;
								break;
							}
						}
						//从n开始  移除1个元素
						arr.splice(n, 1)
						return
					}
					//	   						如果数组长度小于5  加颜色  push其id
					if(arr.length < 5) {
						$(this).css('color', '#33CCFF');
						arr.push(this.text)
					}
				});

			});
			
			var queryData = {};
			queryData.clientType = 102500;
			queryData.positionId = positionId;
			//职位详情
			ajax("/services/position/view", queryData, function(msg){
			var labelsListJson = msg.datas[0].label
				if(labelsListJson){
 			     	var labelsArray = labelsListJson.split(",");

 				 	for (var i=0;i<labelsArray.length;i++){
 						arr.push(labelsArray[i])
 						$("#plabel>span").each(function(){
 							var obj = this.children[0]
 			 					if ($(obj).text() == labelsArray[i]){
 								$(obj).css('color','#33CCFF');
 								return;
 							}
 						});
 					}
				}
			})
			
		});
	}

	function IsInArray(arr, val) {
		if(arr != null) {
			var testStr = ', ' + arr.join(",") + ",";
			return testStr.indexOf("," + val + ",") != -1;
		}
		return false
	}
	
	/* 查询职位类型 */
		function quWoPoTyId(datass){
		//成功部分
		var parentIdData = {};
		parentIdData.parentId = datass;
		parentIdData.clientType = 102500;
		ajax("/services/base/data/work/position/type/list", parentIdData, function(msg) {
			var msgData = msg.datas;
			var positionTypeId1 = document.getElementById("positionTypeId1")
		//第一格里的全部数据
			for(var i = 0; i < msgData.length; i++) {
				if(msgData[i].parentId == 0) {
					var option = document.createElement("option");
					option.value = msgData[i].id;
					option.innerHTML = msgData[i].name;
					positionTypeId1.append(option);
				}
			}
		//设定第一格默认
			var queryData = {};
			queryData.clientType = 102500;
			queryData.positionId = positionId;
			ajax("/services/position/view", queryData, function(msg){
				console.log(msg)
				var datas = msg.datas[0].workPositionTypeParentId;
				for (var i = 0; i < positionTypeId1.length; i++) {
					if(positionTypeId1[i].value == datas){
						positionTypeId1[i].selected = true;
					}
				}
	  		})
		//给第二格添加数据
			var ops = "<option value='-1 '>====请选择职位类型====</option>";
			for(var i = 0; i < msgData.length; i++) {
				if(msgData[i].parentId == datass) {
					ops += "<option value=' " + msgData[i].id + " '>" + msgData[i].name + "</option>";
				}
				$("#positionTypeId2").html(ops);
			};
		//设定第二格默认
			var queryData = {};
			queryData.clientType = 102500;
			queryData.positionId = positionId;
			ajax("/services/base/data/work/position/type/list", queryData, function(msg){
				var ops2 = "<option value='-1 '>====请选择职位类型====</option>"
				for (var i = 0; i < msg.datas.length; i++) {
			//循环所有的数据数组,如果它的parentId 和 第一格中的id想等 就放入ops2,再放入第二个select
					if(msg.datas[i].parentId == positionTypeId1.value){
						ops2 += "<option value=' " + msg.datas[i].id + " '>" + msg.datas[i].name + "</option>";
						$("#positionTypeId2").html(ops2);
							
					//	在ops2中,如果传过来的内容 和 已有的想等,就让已有的为默认.
						var queryData = {};
						queryData.clientType = 102500;
						queryData.positionId = positionId;
						ajax("/services/position/view", queryData, function(msg){
							var datas = msg.datas[0].workPositionTypeName;
							var positionTypeId2 = document.getElementById("positionTypeId2")
							for (var i = 0; i < positionTypeId2.length; i++) {
								if(positionTypeId2[i].text == datas){
									positionTypeId2[i].selected = true;
								}
							}
				  		})
					}
		  		}
			});
		})
	}
	//初始parentId为0 
	function queryWorkPositionTypeId1(datass){
		//成功部分
		var parentIdData = {};
		parentIdData.parentId = datass;
		parentIdData.clientType = 102500;
		ajax("/services/base/data/work/position/type/list", parentIdData, function(msg) {
			var msgData = msg.datas;
			var positionTypeId1 = document.getElementById("positionTypeId1")
			for(var i = 0; i < msgData.length; i++) {
				if(msgData[i].parentId == 0) {
					var option = document.createElement("option");
					option.value = msgData[i].id;
					option.innerHTML = msgData[i].name;
					positionTypeId1.append(option);
				}
			}
			var ops = "<option value='-1 '>====请选择职位类型====</option>";
			for(var i = 0; i < msgData.length; i++) {
				//首次为0 
				if(msgData[i].parentId == datass) {
					ops += "<option value=' " + msgData[i].id + " '>" + msgData[i].name + "</option>";
				}
				$("#positionTypeId2").html(ops);
			};
		});
	}
	function queryWorkPositionTypeId2() {
		//option.id
		var datass = $("#positionTypeId1").val()
		queryWorkPositionTypeId1(datass)
	}
	
	
	/* 查询工资范围 */
	function querySalaryScope() {
		var parentIdData = {};
		parentIdData.clientType = 102500;
		ajax("/services/base/data/salary/scope/list", parentIdData, function(msg){
			var ops = "<option value='-1 '>=====请选月薪范围=====</option>";;
			for(var i = 0; i < msg.datas.length; i++) {
				ops += "<option value=' " + msg.datas[i].id + " '>" + msg.datas[i].name + "</option>";
			};
			$("#salaryScope").html(ops);
				var queryData = {};
				queryData.clientType = 102500;
				queryData.positionId = positionId;
			//职位详情
				var salaryScope = document.getElementById("salaryScope");
				ajax("/services/position/view", queryData, function(msg){
					var datas = msg.datas[0].salaryScopeName;
					for (var i = 0; i < salaryScope.length; i++) {
						if(salaryScope[i].text == datas){
							salaryScope[i].selected = true;
						}
					}
		  		})
 			}
		);
	}
	
	
	/* 查询工作性质 */
		function queryNatureWork() {
			var type = "job_category";
			var data = {};
			data.type = type;
			data.clientType = 102500;
			ajax("/services/dict/type/list", data, function(msg) {
				var ops = "<option value='-1 '>====请选工作性质====</option>";
				for(var i = 0; i < msg.datas.length; i++) {
					ops += "<option value=' " + msg.datas[i].code + " '>" + msg.datas[i].name + "</option>";
				};
				$("#natureWork").html(ops);
				var queryData = {};
				queryData.clientType = 102500;
				queryData.positionId = positionId;
			//职位详情
				var natureWork = document.getElementById("natureWork");
				ajax("/services/position/view", queryData, function(msg){
					var datas = msg.datas[0].jobCategory;
					for (var i = 0; i < natureWork.length; i++) {
						if(natureWork[i].text == datas){
							natureWork[i].selected = true;
						}
					}
		  		})
			});
		}
					
					
	/* 查询工作地点 （参考工作类型）  初始parentId为0  */
		function queryAddress(type, code) {
			var data = {};
			data.type = type;
			data.code = code;
			data.clientType = 102500;
			data.clientType = "102500";
			ajax("/services/dict/type/list", data, function(msg) {
				var msgData = msg.datas;
				var province = document.getElementById("province")
				for(var i = 0; i < msgData.length; i++) {
					if(msgData[i].parentId == 0) {
						var option = document.createElement("option");
						option.value = msgData[i].id;
						option.innerHTML = msgData[i].name;
						province.append(option);
					}
				}
						var queryData = {};
						queryData.clientType = 102500;
						queryData.positionId = positionId;
					//职位详情
						ajax("/services/position/view", queryData, function(msg){
					//获取了省份
							var datas = msg.datas[0].workCity.split('_ ')[0];
							console.log(datas)
							for (var i = 0; i < province.length; i++) {
								if(province[i].text == datas){
									province[i].selected = true;
								}
							}
				  		})
	
				var ops = "<option value='-1 '>==选择城市==</option>";
				for(var i = 0; i < msgData.length; i++) {
					if(msgData[i].parentId == code) {
						ops += "<option value=' " + msgData[i].id + " '>" + msgData[i].name + "</option>";
					}
					$("#city").html(ops);
					//城市的默认值
						var queryData = {};
						queryData.clientType = 102500;
						queryData.positionId = positionId;
					//职位详情
						var city = document.getElementById("city")
						ajax("/services/position/view", queryData, function(msg){
					//获取了省份
							var datas = msg.datas[0].workCity.split('_ ')[1];
							for (var i = 0; i < city.length; i++) {
								if(city[i].text == datas){
									city[i].selected = true;
								}
							}
				  		})
					};
				});
			}

		function queryDistrict2(type,code) {
			var data = {};
			data.type = type;
			data.code = code;
			data.clientType = 102500;
			//      data.type = "province";
			data.clientType = "102500";
			console.log(type, code)
			ajax("/services/dict/type/list", data, function(msg) {
				console.log(msg)
				var msgData = msg.datas;
				var ops2 = "<option value='-1 '>==选择区县==</option>";
				for(var i = 0; i < msgData.length; i++) {
					if(msgData[i].parentId == code) {
						ops2 += "<option value=' " + msgData[i].id + " '>" + msgData[i].name + "</option>";
					}
					$("#district").html(ops2);
					//县区的默认值
						var queryData = {};
						queryData.clientType = 102500;
						queryData.positionId = positionId;
					//职位详情
						var district = document.getElementById("district")
						ajax("/services/position/view", queryData, function(msg){
					//获取了省份
							var datas = msg.datas[0].workCity.split('_ ')[2];
							console.log(datas)
							for (var i = 0; i < district.length; i++) {
								if(district[i].text == datas){
									district[i].selected = true;
								}
							}
				  		})
					};
				});
			}

		//选择省的时候调用
		function queryCity() {
			var data = $("#province").val()
			//让type变成city，data为选中的某省
			type = "city"
			queryAddress(type, data)
		}

		function queryDistrict(){
			var data = $("#city").val()
			type = "district"
			queryDistrict2(type, data)
		}
					
			

//	function queryAddress(type,code){
//	    var queryData={};
//      queryData.type=type;
//      queryData.code=code;
//		$.ajax({
//			type:"post",
//			url:"${pageContext.request.contextPath }/mcbn/services/admint/position/queryAddress",
//          data:JSON.stringify(queryData),
//          dataType:"json",
//          contentType: "application/json",
//			async:false,
//			success:function(msg){
//				  var ops = ' ';
//				  if (type == 'province '){
//	    		  	 ops="<option value='-1 '>=请选省份=</option>";
//				  }else if(type == 'city '){
//	                 ops="<option value='-1 '>=请选城市=</option>";
//	              }else{
//	                 ops="<option value='-1 '>=请选区域=</option>";
//	              }
//				  $.each(msg,function(i,dictItem){
//		    			ops+="<option value=' "+dictItem.code+" '>"+dictItem.name+"</option>";
//    			  });
// 			      if (type == "province"){
// 			    	 $("#province").html(ops);
// 			      }else if (type == "city"){
// 			    	 $("#city").html(ops);
// 			      }else if(type == "district"){
//	                 $("#district").html(ops);
//	              }
// 			} 
//		});
//	}
//	var workCityJson = '${position.workCity} ';
//	var workCity = workCityJson.split('_ ');

//	function queryCity(){
//		var data = $("#province").val()
//		type = "city"
//		queryAddress(type,data)
//		$("#city").val(workCity[1]);
//		queryDistrict();
//	}
//	function queryDistrict(){
//		var data = $("#city").val()
//		type = "district"
//		queryAddress(type,data)
//		$("#district").val(workCity[2]);
//	}
	
	/* 查询工作经验 */
	function queryWorkExperience() {
		var parentIdData = {};
		parentIdData.clientType = 102500;
		ajax("/services/base/data/work/experience/list", parentIdData, function(msg) {
			var ops = "<option value='-1 '>====请选工作经验要求====</option>";
			for(var i = 0; i < msg.datas.length; i++) {
			//				  $.each(msg,function(i,workExperience){
			ops += "<option value=' " + msg.datas[i].id + " '>" + msg.datas[i].name + "</option>";
		}
		$("#workExperience").html(ops);
		var queryData = {};
		queryData.clientType = 102500;
		queryData.positionId = positionId;
	//职位详情
		var workExperience = document.getElementById("workExperience");
		ajax("/services/position/view", queryData, function(msg){
			var datas = msg.datas[0].workExperienceName;
			for (var i = 0; i < workExperience.length; i++) {
				if(workExperience[i].text == datas){
					workExperience[i].selected = true;
				}
			}
  		})
	});
	}
	
	/* 查询学历*/
	function queryEeducation() {
		var type = "degree_level";
		var data = {};
		data.type = type;
		data.clientType = 102500;
		ajax("/services/dict/type/list", data, function(msg) {
			var ops = "<option value='-1 '>====请选择学历要求====</option>";
			for(var i = 0; i < msg.datas.length; i++) {
				ops += "<option value=' " + msg.datas[i].code + " '>" + msg.datas[i].name + "</option>";
			}
			$("#education").html(ops);
			var queryData = {};
			queryData.clientType = 102500;
			queryData.positionId = positionId;
		//职位详情
			var education = document.getElementById("education");
			ajax("/services/position/view", queryData, function(msg){
				var datas = msg.datas[0].degreeLevel;
				for (var i = 0; i < education.length; i++) {
					if(education[i].text == datas){
						education[i].selected = true;
					}
				}
	  		})
		});
	}
	
	function  getRadio(){ 
	   		e  =  event.srcElement;
  	        if(e.value=="yes"){
	    	 	 /* $('#interViewTime ').hide('slow ');  */
	        	 $("#interViewTime").css('display ','none ');  
	    	}else{
     		 	 /* $('#interViewTime ').show('slow ');  */
	    		 $("#interViewTime").css('display ','block ');  
	     	}
    } 

function submit(){
		var label = arr.join(",");
		if ($("#positionTypeId1").val() == -1){
            $('#prompt ').html('请选择职位类型 ');
            $('#myModal ').modal('show ');
            return;
		}
		if ($("#salaryScope").val() == -1){
            $('#prompt ').html('请选择月薪范围 ');
            $('#myModal ').modal('show ');
            return;
		}
		if (label == ""){
            $('#prompt ').html('请选择标签 ');
            $('#myModal ').modal('show ');
            return;
		}
		
		if ($("#province").val() == -1){
            $('#prompt ').html('请输选择省份 ');
            $('#myModal ').modal('show ');
            return;
		}else if ($("#city").val() == -1){
            $('#prompt ').html('请输选择城市 ');
            $('#myModal ').modal('show ');
            return;
		}else if ($("#district").val() == -1){
			$('#prompt ').html('请输选择区域 ');
			$('#myModal ').modal('show ');
			return;
		}
		
		if ($("#natureWork").val() == -1){
            $('#prompt ').html('请选择工作性质 ');
            $('#myModal ').modal('show ');
            return;
		}
		if ($("#workExperience").val() == -1){
            $('#prompt ').html('请选择工作经验 ');
            $('#myModal ').modal('show ');
            return;
		}
		if ($("#education").val() == -1){
            $('#prompt ').html('请选择学历要求 ');
            $('#myModal ').modal('show ');
            return;
		}
		if ($("#description").val() == ""){
            $('#prompt ').html('请输入职位描述 ');
            $('#myModal ').modal('show ');
            return;
		}else if ($("#description").val().length > 500){
			 $('#prompt ').html('职位描述超出字数限制 ');
            $('#myModal ').modal('show ');
            return;
		}
		if ($("#responsibility").val() == ""){
            $('#prompt ').html('请输入岗位职责 ');
            $('#myModal ').modal('show ');
            return;
		}else if($("#responsibility").val().length > 500){
			$('#prompt ').html('岗位职责超出字数限制 ');
            $('#myModal ').modal('show ');
            return;
		}
		
		if ($("#addressDetail").val() == ""){
            $('#prompt ').html('请选择详细地址 ');
            $('#myModal ').modal('show ');
            return;
		}
		
		if ($("#interViewTime").css("display")=="block"){
			if ($("#startTime").val() == "" || $("#endTime").val() == ""){
	            $('#prompt ').html('请输入面试时间 ');
	            $('#myModal ').modal('show ');
	            return;
			}
		}
		var startTime = $("#startTime").val()
		var endTime = $("#endTime").val()
		if (startTime != ' '){
			var timestamp1 = Date.parse(new Date(startTime));
		}
		if (endTime != ' '){
			var timestamp2 = Date.parse(new Date(endTime));
		}

        var data={};
		var workCity = $("#province").val()+'_ '+$("#city").val()+'_ '+$("#district").val();
        <!--data.id = ${position.id}-->
            data.companyId = companyId
        if($("#positionTypeId2").val() == -1){
            data.workPositionTypeId = $("#positionTypeId1").val();
        }else{
            data.workPositionTypeId = $("#positionTypeId2").val();
        }
        data.name = "${position.name}";
        data.salaryScopeId = $("#salaryScope").val()
		data.workCity = workCity;
		data.jobCategory = $("#natureWork").val();
		data.workExperienceId = $("#workExperience").val();
		data.degreeLevel = $("#education").val();
		data.label = label
		data.description = $("#description").val();
		data.videoInterviewStartDate = timestamp1;
		data.videoInterviewEndDate = timestamp2;
		data.detailedAddress = $("#addressDetail").val();
		data.lon = $("#lon").val()
		data.lat = $("#lat").val()
		data.responsibility = $("#responsibility").val()
		loginPostData = JSON.stringify(data)
		$.ajax({
			type:"post",
			url:"${pageContext.request.contextPath }/mcbn/services/admint/position/update",
			data:loginPostData,
			dataType:"json",
			contentType: 'application/json;charset=UTF-8 ',
			success:function(msg){
				if (msg == 1){
					location.href="${pageContext.request.contextPath}/mcbn/services/admint/position/jumpAdminPositionManage?flag=rePublish&companyId="+companyId;
				} 
			}
		});
	}

    function showMap(){
        $('#map ').modal('show ');
        if($("#addressDetail").val() == "") {
            geolocation.getCurrentPosition();
        } else {
            $("#mapAddress").val($("#addressDetail").val());
            makeMarker(lngData,latData,$("#addressDetail").val());
        }
    }
    function searchAddressfunc(status, result) {
        if(status == "complete" && result.info == "OK"){
            var f = result.poiList.pois[0];
            address = f.name + f.address;
            $("#mapAddress").val(address);
            lngData = f.location.lng;
            latData = f.location.lat;
            makeMarker(lngData, latData, address);
        }
    }
    function makeMarker(lng, lat, address){
        map.remove(markers);
        markers = [];
        var marker = new AMap.Marker({
            position: [lng, lat],
            title: address,
            map: map
        });
        marker.setMap(map);
        markers.push(marker);
        map.setCenter([lng, lat]);
    }
    function onComplete(data){
        lngData = data.position.getLng();
        latData = data.position.getLat();
        var lnglatXY = [lngData,latData];
        address = data.formattedAddress;
        $("#mapAddress").val(address);
        map.remove(markers);
        markers = [];
        marker = new AMap.Marker({
            position: lnglatXY,
            title: address,
            map: map
        });
        markers.push(marker);
    }
</script>
<!--<script type="text/javascript" src="/static/manager/js/accordion.js"></script>-->
<!--<script type="text/javascript" src="/static/manager/js/commomTop.js"></script>-->
<!--<link href="/static/manager/css/accordion.css" rel="stylesheet" type="text/css" />-->
<!--<link href="/static/manager/css/commonTop.css" rel="stylesheet" type="text/css" />-->
</body>
</html>